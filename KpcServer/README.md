# Hikari
運営サーバとの通信を仲介する「メインマシンのプログラム」

## 仕様

* 運営サーバとの送受信を簡単にする
* TCP:25252 で待ち受け
* クライアントが繋いできたら、公式フォーマットを独自フォーマットに変換して問題を送信
* クライアントから独自フォーマットの回答が来たら、公式フォーマットに変換して、運営サーバに回答する
* クライアントは何台居ても良い
* 運営サーバに回答する際は、今までで一番良い回答でなれば送信しない

## 使い方

1. 起動
2. クライアントを接続させる(別に後でもいいけど)
3. 回答URLや、問題ファイルのURLを指定する(Drag&Dropでローカルファイルの読み込みにも対応している)
4. 「開始」する(URLやファイルの読み込みに失敗した場合、起動しない)
5. あとはクライアントが勝手にやってくれる
6. 試合終了したかったら「終了」

## 独自フォーマット

### 問題
以下のフォーマットで、クライアントに送信する。
ただし、実際に送信されるのは、`[LF]`までであり、それより先は説明のためである。

    0 0 32 32[LF]          # ブロックを配置することができる最小の矩形領域の右上座標(x1,y1)と左下座標(x2,y2)を[SP]で区切って並べ、で[LF]を付けた行。
    000100011100111...[LF] # 敷地情報(1024文字)を横に並べ、[LF]を...
    20[LF]                 # 石の数をASCII文字で示して、[LF]
    000011111....[LF]      # 石情報(64文字)その1で[LF]
        :
        :
    011100000....[LF]      # 石情報そのN(3行目の石の数)で[LF]

最終行に空行を挿入するなどの操作は、*行わない*。

### 回答
以下のフォーマットで、クライアントから受信する。
ただし、実際に送信されるのは、やっぱり`[LF]`までである。

    H 270 x y[LF]   # 公式フォーマットの順番を少し変え、改行コードを[LF]にしただけである

このフォーマット、または空行が石の数だけ繰り替えされる。
仮に、回答行数が石の数に満たない場合や、多すぎる場合、適切に埋めたり切ったりして、
なんとか公式フォーマットに合うように努力する。


## クライアントの挙動
クライアントの挙動についても述べる。以下のようになる。

1. Hikariに接続
2. `クライアントの名前` + `[LF]`を送信
3. `G`(GetReady) + `[LF]`を送信
4. Hikariから問題を受信
5. 必死に解く
6. `S` + `[LF]`を送信して、回答を送信することを伝える
7. 回答を送信
8. `E` + `[LF]`で回答が完了したことを伝える
9. `O`を受信すれば5.に戻る、`X`であれば3.に戻る

試合が開始された後でも、正しく接続できるが、
処理時間の観点から、試合開始までに3.までの処理が完了していることが望ましい。
